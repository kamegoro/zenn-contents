---
title: "jsPDFãƒ»html2canvasã§å‹•çš„ãªãƒ‡ãƒ¼ã‚¿ã‚’PDFå‡ºåŠ›ã—ãŸè©±"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---

https://zenn.dev/praha/articles/aab4b7cbe175f0

## ã¯ã˜ã‚ã«

åˆã‚ã¾ã—ã¦ã€ã‹ã‚ã”ã‚ã¨ç”³ã—ã¾ã™ã€‚
ä»Šæ—¥ã¯ã€æ¥­å‹™ã§ `jsPDF`ãƒ»`html2canvas` ã‚’ç”¨ã„ãŸå‹•çš„ãªãƒšãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ã® PDF å‡ºåŠ›å®Ÿè£…ã§è‹¦æˆ¦ã—ãŸã®ã§æ€ã„å‡ºã¨ã—ã¦è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

`Svelte.kit` ã§ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ä½œã‚Šã¾ã—ãŸãŒ `React`ã€`Vue` ã‚’è§¦ã£ã¦ã„ã‚‹æ–¹ã§ã‚‚åˆ†ã‹ã‚‹å†…å®¹ã«ãªã£ã¦ã„ã¾ã™ã€‚
ãœã²æœ€å¾Œã¾ã§ãŠä»˜ãåˆã„ãã ã•ã„ã€‚

ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã™ã€‚

https://github.com/kamegoro/screen-pdf-output-app

## TL;DR

- ãƒšãƒ¼ã‚¸æ•°ãŒå¤šããªã‚‹å ´åˆã«ã¯å‘ã„ã¦ã„ãªã„ã€‚
- å¤–éƒ¨ã‹ã‚‰èª­ã¿è¾¼ã‚€ç”»åƒã¯å…¨ã¦ã‚’æç”»ã™ã‚‹ã“ã¨ãŒã§ããªã‹ã£ãŸã€‚
- ãƒšãƒ¼ã‚¸æ•°ãŒå¤šããªã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ã€‚
- ã¾ã ã€æ”¹å–„ã®ä½™åœ°ã¯ã‚ã‚Šãã†ã€‚

## ãªãœ jsPDF ã¨ html2Canvas ã§ã‚„ã£ã¦ã¿ã‚ˆã†ã¨ãªã£ãŸã®ã‹

### html2canvas

https://github.com/niklasvh/html2canvas/

`html2canvas`ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ Element ã‚’ CanvasElement ã«æç”»ã™ã‚‹ã“ã¨ã§ç”»åƒåŒ–ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

æ—¢ã«ã€ç¤¾å†…ã®ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§é‹ç”¨ã•ã‚Œã¦ãŠã‚Šå°å…¥ã‚³ã‚¹ãƒˆãŒä½ã‹ã£ãŸç‚¹ã§æ¡ç”¨ã—ã¾ã—ãŸã€‚

### jsPDF

https://github.com/parallax/jsPDF

JavaScript ã§ PDF ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚
`jsPDF`ã®ä»–ã«ã€`pdfMake`ã‚„`pdf-lib`ç­‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚‚å¯èƒ½ã§ã™ãŒã€ç›´è¿‘ä¸€å¹´é–“ã®ä½¿ç”¨ç‡ã‚„ä»¥å‰ä½¿ç”¨ã—ãŸçµŒé¨“ãŒã‚ã£ãŸç‚¹ã‹ã‚‰æ¡ç”¨ã—ã¾ã—ãŸã€‚

![pdf-npm-trend](/Images/pdf/pdf-graph.png)

## PDF å‡ºåŠ›ã¾ã§ã®æµã‚Œ

PDF åŒ–ã¾ã§ä¸‹è¨˜ã®æµã‚Œã«ãªã‚Šã¾ã™ã€‚

1. ãƒšãƒ¼ã‚¸ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹`HTMLElement`ã‚’ html2canvas ã§ canvasElement ã«æç”»ã€‚
1. canvasElement ã®ç¸¦æ¨ªã®æ¯”ç‡ã‚’ç¶­æŒã—ãŸã¾ã¾ PDF ã‚µã‚¤ã‚ºã«å¤‰æ›ã€‚
1. PDF ã®å„ãƒšãƒ¼ã‚¸ã”ã¨ã«æç”»ã§ãã‚‹ç¯„å›²ã§ã€å†åº¦ canvasElement ã‚’ç”Ÿæˆã™ã‚‹ã€‚
1. å…¨ã¦æç”»ã—çµ‚ã‚ã‚‹ã¾ã§ Step3 ã‚’ç¹°ã‚Šè¿”ã™ã€‚

`jsPDF`ã¨`html2canvas`ã®èª¬æ˜ã¯å‰²æ„›ã•ã›ã¦é ‚ãã¾ã™ã®ã§ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”ç¢ºèªãã ã•ã„ã€‚

#### jsPDF

https://raw.githack.com/MrRio/jsPDF/master/docs/index.html

#### html2canvas

https://html2canvas.hertzen.com/

## å®Ÿè£…è©³ç´°

### Step1

```ts
import html2canvas from 'html2canvas';
import jsPDF from 'jspdf';

const generatePdf = async (element: HTMLElement) => {
 const doc = new jsPDF('p', 'mm', 'a4', true);

 // A4ã‚µã‚¤ã‚ºã®PDFã®é«˜ã•ãƒ»æ¨ªå¹…
 const pdfWidth = doc.internal.pageSize.getWidth();
 const pdfHeight = doc.internal.pageSize.getHeight();

 // å¼•æ•°ã«æ¸¡ã—ãŸElementãŒCanvasElementã«æç”»ã•ã‚Œã¦è¿”ã•ã‚Œã‚‹
 const canvas = await html2canvas(element);
                       .
                       .
                       .
}
```

### Step2

`HTMLCanvasElement`ã® PDF ä¸Šã§ã®é«˜ã•ã‚’è¨ˆç®—ã—ã¾ã™ã€‚

```ts
// ç¸¦æ¨ªã®æ¯”ç‡ã‚’ç¶­æŒã—ãŸã¾ã¾PDFã‚µã‚¤ã‚ºã«å¤‰æ›
const convertCanvasHeightForPdf = (
  canvasHeight: number,
  canvasWidth: number,
  pdfContentWidth: number
) => {
  return (canvasHeight * pdfContentWidth) / canvasWidth;
};
```

### Step3

ä¸€ã¤ã® CanvasElement ã®æç”»ç¯„å›²ã‚’æŒ‡å®šã—ã¦ä½¿ã„å›ã™ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ãŒã€ç”Ÿæˆã•ã‚ŒãŸ PDF ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¨ãƒ¢ãƒƒã‚µãƒªã—ãŸå‹•ãã«ãªã‚Šã¾ã™ã€‚
Adobe Reader ç­‰ã®ãƒ„ãƒ¼ãƒ«ã§é–‹ãã¨åˆ†ã‹ã‚Šã¾ã™ãŒã€è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„éƒ¨åˆ†ã«ã‚‚ç”»åƒãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

| æ‚ªã„ä¾‹                          | è‰¯ã„ä¾‹                            |
| ------------------------------- | --------------------------------- |
| ![bad](/Images/pdf/pdf-bad.png) | ![good](/Images/pdf/pdf-good.png) |

ãƒšãƒ¼ã‚¸ã‚’è·¨ãéš›ã«è‰¯ã—ãªã«ç”»åƒã‚’åˆ‡ã‚Šåˆ†ã‘ã¦ã¯è²°ãˆãªã„ã®ã§ã€ä»Šå›ã¯ CanvasElement ã‚’å…ƒã«ãƒšãƒ¼ã‚¸æ¯ã«æ–°ã—ã„ CanvasElement ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°ã‚’ä½œã‚Šã¾ã™ã€‚

```ts
const clipCanvas = (
  baseCanvas: HTMLCanvasElement,
  canvasPdfY: number,
  pdfWidth: number,
  clipPdfHeight: number
) => {
  const clipCanvas = document.createElement("canvas");

  // PDFã®é«˜ã•ã‹ã‚‰Canvasã®é«˜ã•ã‚’é€†ç®—
  const clipCanvasHeight = (pdfHeight: number) =>
    (pdfHeight * baseCanvas.width) / pdfWidth;

  clipCanvas.width = baseCanvas.width;
  clipCanvas.height = clipCanvasHeight(clipPdfHeight);
  const context = clipCanvas.getContext("2d");
  if (context) {
    context.drawImage(baseCanvas, 0, clipCanvasHeight(canvasPdfY));
  }

  return {
    height: clipCanvas.height,
    width: clipCanvas.width,
    dataUrl: clipCanvas.toDataURL("image/png"),
  };
};
```

## è‹¦åŠ´ã—ãŸã¨ã“ã‚

## è‰¯ã‹ã£ãŸã¨ã“ã‚

## æ‚ªã‹ã£ãŸã¨ã“ã‚
